---
phase: 01-specification-audit
plan: 05
type: execute
wave: 2
depends_on: ["01-01", "01-02", "01-03", "01-04"]
files_modified: [
  ".planning/phases/01-specification-audit/AUDIT-REPORT.md",
  ".planning/phases/01-specification-audit/CORRECTIVE-TASKS.md"
]
autonomous: true

must_haves:
  truths:
    - "Complete audit report aggregates findings from all 4 component audits"
    - "All 69 v1 requirements have been verified (13 CLI + 7 SRV + 6 CLT + 10 SMP + 9 REV + 6 STA + 12 CTL + 10 TUI)"
    - "Audit report shows compliance percentage and critical gaps"
    - "Corrective tasks are prioritized and actionable"
    - "Report includes architecture/data flow validation"
  artifacts:
    - path: ".planning/phases/01-specification-audit/AUDIT-REPORT.md"
      provides: "Comprehensive specification audit report"
      contains: "Executive summary, compliance matrix, gap analysis"
    - path: ".planning/phases/01-specification-audit/CORRECTIVE-TASKS.md"
      provides: "Prioritized list of fixes needed"
      contains: "Task list with priority, effort, and acceptance criteria"
  key_links:
    - from: "All 4 audit summaries"
      to: "AUDIT-REPORT.md"
      via: "aggregation and analysis"
---

<objective>
Compile comprehensive specification audit report from all component audits and create prioritized corrective task list.

Purpose: Provide a complete picture of how implementation matches specification, identify gaps, and create actionable remediation plan.

Output: 
1. AUDIT-REPORT.md - Complete audit findings with compliance metrics
2. CORRECTIVE-TASKS.md - Prioritized list of fixes with effort estimates
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@./plan.md
@./.planning/phases/01-specification-audit/01-01-SUMMARY.md
@./.planning/phases/01-specification-audit/01-02-SUMMARY.md
@./.planning/phases/01-specification-audit/01-03-SUMMARY.md
@./.planning/phases/01-specification-audit/01-04-SUMMARY.md

## Requirements Summary

| Category | Count | Component | File |
|----------|-------|-----------|------|
| CLI | 13 | Command-line interface | main.rs |
| SRV | 7 | Server management | server.rs |
| CLT | 6 | OpenCode client | client.rs |
| SMP | 10 | Output sampler | sampler.rs |
| REV | 9 | Reviewer API | reviewer.rs |
| STA | 6 | State management | state.rs |
| CTL | 12 | Control loop | control_loop.rs |
| TUI | 10 | Terminal UI | tui/mod.rs |
| **TOTAL** | **69** | | |

## Success Criteria (from Phase Goal)

1. Every component from plan.md exists with correct interface
2. All CLI arguments from spec are implemented
3. Error handling matches strategy in plan.md
4. Data flow matches architecture diagram
5. Default behaviors match specification

## Deliverables

- Audit report documenting deviations
- List of gaps or missing features
- Corrective tasks identified
</context>

<tasks>

<task type="auto">
  <name>Task 1: Aggregate Audit Findings</name>
  <files>
    .planning/phases/01-specification-audit/01-01-SUMMARY.md
    .planning/phases/01-specification-audit/01-02-SUMMARY.md
    .planning/phases/01-specification-audit/01-03-SUMMARY.md
    .planning/phases/01-specification-audit/01-04-SUMMARY.md
  </files>
  <action>
Read all 4 audit summary files and aggregate findings into a comprehensive analysis.

Create aggregation tables:

**Overall Compliance Matrix:**
| Category | Total | Passed | Failed | Compliance % |
|----------|-------|--------|--------|--------------|
| CLI | 13 | X | Y | Z% |
| SRV | 7 | X | Y | Z% |
| CLT | 6 | X | Y | Z% |
| SMP | 10 | X | Y | Z% |
| REV | 9 | X | Y | Z% |
| STA | 6 | X | Y | Z% |
| CTL | 12 | X | Y | Z% |
| TUI | 10 | X | Y | Z% |
| **TOTAL** | **69** | **X** | **Y** | **Z%** |

**Critical Issues (Blockers):**
- List any requirements that are completely missing or fundamentally broken
- Note impact on system functionality

**Deviations Summary:**
- Aggregate all deviations from the 4 summaries
- Categorize by severity: Critical, Major, Minor
- Group by component for easier tracking

**Architecture Validation:**
- Verify data flow from plan.md architecture diagram is implemented
- Check component interactions match specification
- Note any missing connections or wiring

**Error Handling Audit:**
- Check if error handling strategy from plan.md is followed:
  - Critical errors (Abort): Server fails, connection fails, session creation fails
  - Recoverable errors (Retry): Reviewer API timeout, network transient
  - Default behaviors match table in spec
  </action>
  <verify>Read all 4 SUMMARY.md files and compile counts for compliance matrix</verify>
  <done>Aggregation complete with compliance percentages calculated</done>
</task>

<task type="auto">
  <name>Task 2: Generate Audit Report</name>
  <files>.planning/phases/01-specification-audit/AUDIT-REPORT.md</files>
  <action>
Create comprehensive AUDIT-REPORT.md:

```markdown
# OpenCode Runner - Specification Audit Report

**Phase:** 01 - Specification Audit  
**Date:** 2026-02-05  
**Auditor:** Claude (GSD Planner)  
**Scope:** All 69 v1 requirements from plan.md

---

## Executive Summary

**Overall Compliance:** X/69 requirements (Y%)

**Status:** [PASS with minor issues / PASS with major issues / FAIL - requires remediation]

**Summary:**
Brief paragraph describing the overall state of implementation vs specification.

---

## Compliance by Component

| Component | Requirements | Passed | Failed | Compliance |
|-----------|--------------|--------|--------|------------|
| CLI (main.rs) | 13 | X | Y | Z% |
| Server (server.rs) | 7 | X | Y | Z% |
| Client (client.rs) | 6 | X | Y | Z% |
| Sampler (sampler.rs) | 10 | X | Y | Z% |
| Reviewer (reviewer.rs) | 9 | X | Y | Z% |
| State (state.rs) | 6 | X | Y | Z% |
| Control Loop (control_loop.rs) | 12 | X | Y | Z% |
| TUI (tui/mod.rs) | 10 | X | Y | Z% |
| **TOTAL** | **69** | **X** | **Y** | **Z%** |

---

## Critical Issues (Blockers)

Issues that prevent system from functioning or violate core requirements:

1. **[REQ-ID]** - [Component] - [Description] - [Impact]
   - Location: `file:line`
   - Details: ...

---

## Deviations from Specification

### By Severity

**Critical (Functionality Impact):**
1. ...

**Major (Spec Non-Compliance):**
1. ...

**Minor (Cosmetic/Naming):**
1. ...

### By Component

**CLI (main.rs):**
- ...

**Server (server.rs):**
- ...

[Continue for all components...]

---

## Architecture Validation

### Data Flow Verification

**Specification Flow:**
[Diagram description from plan.md]

**Implementation Status:**
| Flow Step | Spec | Implemented | Match |
|-----------|------|-------------|-------|
| CLI → Server Manager | ✓ | src/main.rs:88 | ✓ |
| ... | | | |

### Component Interfaces

| Component | Interface | Status | Notes |
|-----------|-----------|--------|-------|
| ServerManager | spawn() | ✓/✗ | ... |
| ... | | | |

---

## Error Handling Audit

### Strategy Compliance

| Strategy Element | Spec | Implementation | Match |
|------------------|------|----------------|-------|
| Critical → Abort | ✓ | src/main.rs | ✓ |
| Reviewer retry | 3 retries | src/reviewer.rs:95 | ✓ |
| Default Continue | ✓ | src/reviewer.rs:127 | ✓ |

### Default Behaviors

| Scenario | Spec Action | Implementation | Match |
|----------|-------------|----------------|-------|
| Reviewer fails | Continue | src/reviewer.rs:131 | ✓ |
| SSE disconnect | Reconnect | [location] | ? |
| Inactivity timeout | Trigger review | src/control_loop.rs:201 | ✓ |
| Max iterations | Abort | src/control_loop.rs:104 | ✓ |

---

## Missing Features

Features from plan.md not yet implemented:

1. **[Feature]** - [Description] - [Priority]

---

## Recommendations

### Immediate Actions (Before Phase 2)
1. ...

### Short-term Improvements
1. ...

### Long-term Enhancements
1. ...

---

## Appendix: Full Requirements Checklist

[Detailed checklist of all 69 requirements with status]
```

Make the report professional and actionable. Include specific file:line references for all issues.
  </action>
  <verify>Verify AUDIT-REPORT.md exists with compliance matrix and critical issues section</verify>
  <done>Comprehensive audit report generated</done>
</task>

<task type="auto">
  <name>Task 3: Create Corrective Tasks List</name>
  <files>.planning/phases/01-specification-audit/CORRECTIVE-TASKS.md</files>
  <action>
Create prioritized corrective task list based on audit findings:

```markdown
# Corrective Tasks - Specification Compliance

**From:** Phase 01 - Specification Audit  
**Generated:** 2026-02-05  
**Total Tasks:** [N]

---

## Priority Legend

- **P0 (Critical):** Blocks functionality or core requirement missing - Fix immediately
- **P1 (High):** Major spec deviation or important feature missing - Fix before Phase 2
- **P2 (Medium):** Minor deviation or improvement - Fix during Phase 2
- **P3 (Low):** Nice to have - Address in future iteration

---

## P0 - Critical (Fix Immediately)

### Task 1: [Brief Description]
- **Requirement:** [REQ-ID]
- **Component:** [File]
- **Issue:** [Detailed description]
- **Location:** `file:line`
- **Fix:** [What needs to be done]
- **Acceptance Criteria:**
  - [ ] Criterion 1
  - [ ] Criterion 2
- **Estimated Effort:** [Small/Medium/Large]
- **Files to Modify:**
  - `src/file.rs`

[Additional P0 tasks...]

---

## P1 - High (Fix Before Phase 2)

[Task list...]

---

## P2 - Medium (Fix During Phase 2)

[Task list...]

---

## P3 - Low (Future Iteration)

[Task list...]

---

## Quick Wins

Tasks that can be completed in <15 minutes:

1. [Task] - [File:Line] - [Description]

---

## Task Statistics

| Priority | Count | Estimated Total Effort |
|----------|-------|------------------------|
| P0 - Critical | X | Y hours |
| P1 - High | X | Y hours |
| P2 - Medium | X | Y hours |
| P3 - Low | X | Y hours |
| **TOTAL** | **X** | **Y hours** |
```

Prioritize tasks based on:
1. Is the requirement critical to system function?
2. Does the deviation break the spec contract?
3. Will it affect downstream phases?
4. How much effort to fix?

Ensure each task has:
- Clear requirement reference
- Specific file:line location
- Actionable fix description
- Measurable acceptance criteria
  </action>
  <verify>Verify CORRECTIVE-TASKS.md exists with P0-P3 prioritization and acceptance criteria</verify>
  <done>Corrective tasks list created with prioritization</done>
</task>

<task type="auto">
  <name>Task 4: Generate Phase Summary</name>
  <files>.planning/phases/01-specification-audit/01-05-SUMMARY.md</files>
  <action>
Create final phase summary:

```markdown
# Phase 01 - Specification Audit Summary

## Phase Completion Status: [COMPLETE / PARTIAL]

## Deliverables Created

1. **01-01-SUMMARY.md** - CLI and Server audit (20 requirements)
2. **01-02-SUMMARY.md** - Client and Sampler audit (16 requirements)
3. **01-03-SUMMARY.md** - Reviewer and State audit (15 requirements)
4. **01-04-SUMMARY.md** - Control Loop and TUI audit (22 requirements)
5. **AUDIT-REPORT.md** - Comprehensive audit findings
6. **CORRECTIVE-TASKS.md** - Prioritized remediation tasks

## Key Findings

**Overall Compliance:** X/69 (Y%)

**Critical Issues:** N
**Major Deviations:** N
**Minor Deviations:** N

## Compliance by Component

[Summary table]

## Architecture Validation

Data flow from spec: [MATCH / PARTIAL / MISSING]
Error handling strategy: [MATCH / PARTIAL / MISSING]
Component interfaces: [MATCH / PARTIAL / MISSING]

## Recommended Next Steps

1. [Immediate action if critical issues exist]
2. [Phase 02 preparation]
3. [Long-term recommendations]

## Risk Assessment

**Low Risk:** Proceed to Phase 02  
**Medium Risk:** Fix P0/P1 tasks first  
**High Risk:** Major rework needed

## Sign-off

This audit has verified implementation against plan.md specification.
Phase is ready to proceed: [YES / WITH CONDITIONS / NO]
```
  </action>
  <verify>Verify 01-05-SUMMARY.md exists with phase completion status</verify>
  <done>Phase summary generated, audit phase complete</done>
</task>

</tasks>

<verification>
- All 4 audit summaries read and aggregated
- Compliance matrix shows X/69 requirements with percentages
- Critical issues identified and documented
- AUDIT-REPORT.md created with executive summary
- CORRECTIVE-TASKS.md created with P0-P3 prioritization
- Architecture and error handling validated
- Phase summary generated with recommendations
</verification>

<success_criteria>
- [ ] All 69 requirements accounted for in compliance matrix
- [ ] Critical issues (if any) documented with file:line references
- [ ] AUDIT-REPORT.md created with executive summary and compliance breakdown
- [ ] CORRECTIVE-TASKS.md created with prioritized tasks and acceptance criteria
- [ ] Architecture flow validated against spec diagram
- [ ] Error handling strategy validated
- [ ] Phase summary includes risk assessment and next steps
</success_criteria>

<output>
After completion, create:
1. `.planning/phases/01-specification-audit/AUDIT-REPORT.md` - Comprehensive audit report
2. `.planning/phases/01-specification-audit/CORRECTIVE-TASKS.md` - Prioritized fix list
3. `.planning/phases/01-specification-audit/01-05-SUMMARY.md` - Phase completion summary
</output>
